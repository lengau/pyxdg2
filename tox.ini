# TODO: Migrate this to pyproject.toml, but only after tox supports it fully.
# See: https://github.com/tox-dev/tox/issues/999
[tox]
min_version = 4.2
no_package = true
env_list =
    poetry-export
    py38
    py39
    py310
    py311
    pypy3
requires =
    setuptools >= 61
labels =
    test = py38, py39, py310, py311, pypy3
    type = pyright
    lint = black_lint, ruff_lint
    fix = black_fix, ruff_fix

[gh]
python =
    3.8 = py38
    3.9 = py39
    3.10 = py310
    3.11 = py311
    pypy3.9 = pypy3
[testenv]
depends = poetry-export
deps = -r requirements-dev.txt
commands = python -m pytest

[testenv:poetry-export]
# Environment just for generating requirements files with poetry.
base =
deps = poetry
commands =
    poetry export -o requirements.txt
    poetry export --dev -o requirements-dev.txt

[testenv:{pyright,ruff_lint,ruff_fix,black_lint,black_fix}]
base =
depends:
    # Make sure we run black before ruff.
    ruff_fix: black_fix
    ruff_lint: black_lint
deps =
    pyright
    ruff
    black
package = skip
description = Static type checking by name
commands =
    type: pyright pyxdg2 tests
    ruff_lint: ruff pyxdg2 tests
    ruff_fix: ruff --fix pyxdg2 tests
    black_lint: black --check --diff pyxdg2 tests
    black_fix: black pyxdg2 tests
